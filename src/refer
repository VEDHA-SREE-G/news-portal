import React, { useState, useEffect } from 'react';
import { Search, Plus, Edit2, Trash2, Eye, X, Menu, User, LogOut, TrendingUp, Clock, Tag } from 'lucide-react';

const NewsPortal = () => {
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const [currentUser, setCurrentUser] = useState(null);
  const [showAuthModal, setShowAuthModal] = useState(false);
  const [isSignUp, setIsSignUp] = useState(false);
  const [showNewsModal, setShowNewsModal] = useState(false);
  const [selectedNews, setSelectedNews] = useState(null);
  const [editingNews, setEditingNews] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedCategory, setSelectedCategory] = useState('All');
  const [showMobileMenu, setShowMobileMenu] = useState(false);

  const [users, setUsers] = useState([
    { id: 1, username: 'admin', password: 'admin123', role: 'admin', name: 'Admin User' },
    { id: 2, username: 'editor', password: 'editor123', role: 'editor', name: 'John Editor' }
  ]);

  const [news, setNews] = useState([
    {
      id: 1,
      title: 'Revolutionary AI Breakthrough in Healthcare',
      content: 'Scientists have developed a groundbreaking AI system that can predict diseases with 95% accuracy. This revolutionary technology analyzes medical imaging and patient data to identify early signs of various conditions, potentially saving millions of lives through early intervention.',
      category: 'Technology',
      author: 'Admin User',
      date: '2025-11-10',
      image: 'https://images.unsplash.com/photo-1576091160399-112ba8d25d1d?w=800',
      views: 1234,
      trending: true
    },
    {
      id: 2,
      title: 'Global Climate Summit Reaches Historic Agreement',
      content: 'World leaders have signed an unprecedented climate accord committing to carbon neutrality by 2040. The agreement includes binding targets for renewable energy adoption and substantial funding for developing nations to transition to clean energy sources.',
      category: 'Environment',
      author: 'John Editor',
      date: '2025-11-11',
      image: 'https://images.unsplash.com/photo-1569163139394-de4798aa62b6?w=800',
      views: 856,
      trending: true
    },
    {
      id: 3,
      title: 'Stock Markets Hit All-Time High',
      content: 'Major stock indices across the globe reached record highs today, driven by strong corporate earnings and positive economic indicators. Analysts attribute the surge to increased consumer confidence and successful vaccination campaigns worldwide.',
      category: 'Business',
      author: 'Admin User',
      date: '2025-11-12',
      image: 'https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?w=800',
      views: 642,
      trending: false
    },
    {
      id: 4,
      title: 'New Archaeological Discovery Rewrites History',
      content: 'Archaeologists have uncovered a 5,000-year-old city that challenges our understanding of ancient civilizations. The discovery includes advanced infrastructure and artifacts suggesting sophisticated urban planning far earlier than previously believed.',
      category: 'Science',
      author: 'John Editor',
      date: '2025-11-13',
      image: 'https://images.unsplash.com/photo-1551988404-caa23d4ec9c4?w=800',
      views: 923,
      trending: true
    }
  ]);

  const [authForm, setAuthForm] = useState({ username: '', password: '', name: '' });
  const [newsForm, setNewsForm] = useState({
    title: '',
    content: '',
    category: 'Technology',
    image: ''
  });

  const categories = ['All', 'Technology', 'Business', 'Environment', 'Science', 'Sports', 'Entertainment'];

  const handleLogin = () => {
    const user = users.find(u => u.username === authForm.username && u.password === authForm.password);
    if (user) {
      setCurrentUser(user);
      setIsLoggedIn(true);
      setShowAuthModal(false);
      setAuthForm({ username: '', password: '', name: '' });
    } else {
      alert('Invalid credentials!');
    }
  };

  const handleSignUp = () => {
    if (users.find(u => u.username === authForm.username)) {
      alert('Username already exists!');
      return;
    }
    const newUser = {
      id: users.length + 1,
      username: authForm.username,
      password: authForm.password,
      name: authForm.name,
      role: 'editor'
    };
    setUsers([...users, newUser]);
    alert('Registration successful! Please login.');
    setIsSignUp(false);
    setAuthForm({ username: '', password: '', name: '' });
  };

  const handleLogout = () => {
    setIsLoggedIn(false);
    setCurrentUser(null);
  };

  const handleAddNews = () => {
    if (!newsForm.title || !newsForm.content || !newsForm.image) {
      alert('Please fill all fields!');
      return;
    }
    const newNews = {
      id: news.length + 1,
      ...newsForm,
      author: currentUser.name,
      date: new Date().toISOString().split('T')[0],
      views: 0,
      trending: false
    };
    setNews([newNews, ...news]);
    setNewsForm({ title: '', content: '', category: 'Technology', image: '' });
    setShowNewsModal(false);
    alert('News added successfully!');
  };

  const handleEditNews = () => {
    if (!newsForm.title || !newsForm.content || !newsForm.image) {
      alert('Please fill all fields!');
      return;
    }
    setNews(news.map(n => n.id === editingNews.id ? { ...editingNews, ...newsForm } : n));
    setNewsForm({ title: '', content: '', category: 'Technology', image: '' });
    setEditingNews(null);
    setShowNewsModal(false);
    alert('News updated successfully!');
  };

  const handleDeleteNews = (id) => {
    if (window.confirm('Are you sure you want to delete this news?')) {
      setNews(news.filter(n => n.id !== id));
    }
  };

  const openEditModal = (newsItem) => {
    setEditingNews(newsItem);
    setNewsForm({
      title: newsItem.title,
      content: newsItem.content,
      category: newsItem.category,
      image: newsItem.image
    });
    setShowNewsModal(true);
  };

  const filteredNews = news.filter(n => {
    const matchesSearch = n.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         n.content.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesCategory = selectedCategory === 'All' || n.category === selectedCategory;
    return matchesSearch && matchesCategory;
  });

  const trendingNews = news.filter(n => n.trending).slice(0, 3);

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50">
      {/* Header */}
      <header className="bg-white shadow-lg sticky top-0 z-50">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex justify-between items-center py-4">
            <div className="flex items-center space-x-3">
              <div className="bg-gradient-to-r from-blue-600 to-indigo-600 p-2 rounded-lg">
                <TrendingUp className="w-6 h-6 text-white" />
              </div>
              <div>
                <h1 className="text-2xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">
                  NewsPortal
                </h1>
                <p className="text-xs text-gray-500">Stay Informed, Stay Ahead</p>
              </div>
            </div>

            <div className="hidden md:flex items-center space-x-4">
              {isLoggedIn ? (
                <>
                  <span className="text-sm text-gray-600">Welcome, <span className="font-semibold text-blue-600">{currentUser.name}</span></span>
                  <button
                    onClick={() => { setShowNewsModal(true); setEditingNews(null); setNewsForm({ title: '', content: '', category: 'Technology', image: '' }); }}
                    className="flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-2 rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all shadow-md"
                  >
                    <Plus className="w-4 h-4" />
                    <span>Add News</span>
                  </button>
                  <button
                    onClick={handleLogout}
                    className="flex items-center space-x-2 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-all shadow-md"
                  >
                    <LogOut className="w-4 h-4" />
                    <span>Logout</span>
                  </button>
                </>
              ) : (
                <button
                  onClick={() => { setShowAuthModal(true); setIsSignUp(false); }}
                  className="flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-6 py-2 rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all shadow-md"
                >
                  <User className="w-4 h-4" />
                  <span>Login</span>
                </button>
              )}
            </div>

            <button onClick={() => setShowMobileMenu(!showMobileMenu)} className="md:hidden">
              <Menu className="w-6 h-6 text-gray-700" />
            </button>
          </div>

          {showMobileMenu && (
            <div className="md:hidden pb-4 space-y-2">
              {isLoggedIn ? (
                <>
                  <button
                    onClick={() => { setShowNewsModal(true); setEditingNews(null); }}
                    className="w-full flex items-center justify-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg"
                  >
                    <Plus className="w-4 h-4" />
                    <span>Add News</span>
                  </button>
                  <button onClick={handleLogout} className="w-full bg-red-500 text-white px-4 py-2 rounded-lg">
                    Logout
                  </button>
                </>
              ) : (
                <button
                  onClick={() => { setShowAuthModal(true); setIsSignUp(false); }}
                  className="w-full bg-blue-600 text-white px-4 py-2 rounded-lg"
                >
                  Login
                </button>
              )}
            </div>
          )}
        </div>
      </header>

      {/* Main Content */}
      <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Search and Filter */}
        <div className="mb-8 space-y-4">
          <div className="relative">
            <Search className="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" />
            <input
              type="text"
              placeholder="Search news articles..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full pl-12 pr-4 py-3 rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:outline-none transition-all shadow-sm"
            />
          </div>

          <div className="flex flex-wrap gap-2">
            {categories.map(cat => (
              <button
                key={cat}
                onClick={() => setSelectedCategory(cat)}
                className={`px-4 py-2 rounded-lg font-medium transition-all ${
                  selectedCategory === cat
                    ? 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-md'
                    : 'bg-white text-gray-700 hover:bg-gray-100 shadow-sm'
                }`}
              >
                {cat}
              </button>
            ))}
          </div>
        </div>

        {/* Trending Section */}
        {trendingNews.length > 0 && (
          <div className="mb-8">
            <div className="flex items-center space-x-2 mb-4">
              <TrendingUp className="w-6 h-6 text-orange-500" />
              <h2 className="text-2xl font-bold text-gray-800">Trending Now</h2>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              {trendingNews.map(n => (
                <div
                  key={n.id}
                  onClick={() => setSelectedNews(n)}
                  className="bg-white rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all cursor-pointer transform hover:-translate-y-1"
                >
                  <div className="relative h-48">
                    <img src={n.image} alt={n.title} className="w-full h-full object-cover" />
                    <div className="absolute top-3 left-3 bg-orange-500 text-white px-3 py-1 rounded-full text-xs font-semibold flex items-center space-x-1">
                      <TrendingUp className="w-3 h-3" />
                      <span>Trending</span>
                    </div>
                  </div>
                  <div className="p-4">
                    <h3 className="font-bold text-lg text-gray-800 line-clamp-2">{n.title}</h3>
                    <div className="flex items-center space-x-4 mt-2 text-xs text-gray-500">
                      <span className="flex items-center space-x-1">
                        <Eye className="w-3 h-3" />
                        <span>{n.views}</span>
                      </span>
                      <span className="flex items-center space-x-1">
                        <Clock className="w-3 h-3" />
                        <span>{n.date}</span>
                      </span>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* News Grid */}
        <div className="mb-4">
          <h2 className="text-2xl font-bold text-gray-800 mb-4">Latest News</h2>
          <p className="text-gray-600 mb-6">Found {filteredNews.length} articles</p>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {filteredNews.map(n => (
            <div key={n.id} className="bg-white rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all transform hover:-translate-y-1">
              <div className="relative h-48">
                <img src={n.image} alt={n.title} className="w-full h-full object-cover" />
                <div className="absolute top-3 right-3 bg-blue-600 text-white px-3 py-1 rounded-full text-xs font-semibold flex items-center space-x-1">
                  <Tag className="w-3 h-3" />
                  <span>{n.category}</span>
                </div>
              </div>
              <div className="p-5">
                <h3 className="font-bold text-xl text-gray-800 mb-2 line-clamp-2">{n.title}</h3>
                <p className="text-gray-600 text-sm mb-4 line-clamp-3">{n.content}</p>
                
                <div className="flex items-center justify-between mb-4">
                  <div className="text-xs text-gray-500">
                    <p className="font-semibold text-gray-700">By {n.author}</p>
                    <p className="flex items-center space-x-1 mt-1">
                      <Clock className="w-3 h-3" />
                      <span>{n.date}</span>
                    </p>
                  </div>
                  <div className="flex items-center space-x-1 text-gray-500 text-xs">
                    <Eye className="w-4 h-4" />
                    <span>{n.views}</span>
                  </div>
                </div>

                <div className="flex space-x-2">
                  <button
                    onClick={() => setSelectedNews(n)}
                    className="flex-1 flex items-center justify-center space-x-2 bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-2 rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all"
                  >
                    <Eye className="w-4 h-4" />
                    <span>Read</span>
                  </button>
                  {isLoggedIn && (
                    <>
                      <button
                        onClick={() => openEditModal(n)}
                        className="flex items-center justify-center bg-green-500 text-white px-3 py-2 rounded-lg hover:bg-green-600 transition-all"
                      >
                        <Edit2 className="w-4 h-4" />
                      </button>
                      <button
                        onClick={() => handleDeleteNews(n.id)}
                        className="flex items-center justify-center bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition-all"
                      >
                        <Trash2 className="w-4 h-4" />
                      </button>
                    </>
                  )}
                </div>
              </div>
            </div>
          ))}
        </div>

        {filteredNews.length === 0 && (
          <div className="text-center py-12">
            <p className="text-gray-500 text-lg">No news articles found matching your criteria.</p>
          </div>
        )}
      </main>

      {/* Auth Modal */}
      {showAuthModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 relative">
            <button onClick={() => setShowAuthModal(false)} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
              <X className="w-6 h-6" />
            </button>

            <div className="text-center mb-6">
              <div className="bg-gradient-to-r from-blue-600 to-indigo-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                <User className="w-8 h-8 text-white" />
              </div>
              <h2 className="text-2xl font-bold text-gray-800">{isSignUp ? 'Create Account' : 'Welcome Back'}</h2>
              <p className="text-gray-500 mt-2">{isSignUp ? 'Join our news community' : 'Login to manage news'}</p>
            </div>

            <div className="space-y-4">
              {isSignUp && (
                <input
                  type="text"
                  placeholder="Full Name"
                  value={authForm.name}
                  onChange={(e) => setAuthForm({ ...authForm, name: e.target.value })}
                  className="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:outline-none transition-all"
                />
              )}
              <input
                type="text"
                placeholder="Username"
                value={authForm.username}
                onChange={(e) => setAuthForm({ ...authForm, username: e.target.value })}
                className="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:outline-none transition-all"
              />
              <input
                type="password"
                placeholder="Password"
                value={authForm.password}
                onChange={(e) => setAuthForm({ ...authForm, password: e.target.value })}
                className="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:outline-none transition-all"
              />
              <button
                onClick={isSignUp ? handleSignUp : handleLogin}
                className="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-indigo-700 transition-all shadow-lg"
              >
                {isSignUp ? 'Sign Up' : 'Login'}
              </button>
            </div>

            <div className="mt-6 text-center">
              <button
                onClick={() => setIsSignUp(!isSignUp)}
                className="text-blue-600 hover:text-blue-700 font-medium"
              >
                {isSignUp ? 'Already have an account? Login' : "Don't have an account? Sign Up"}
              </button>
            </div>

            {!isSignUp && (
              <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                <p className="text-xs text-gray-600 font-semibold mb-2">Demo Credentials:</p>
                <p className="text-xs text-gray-600">Admin: admin / admin123</p>
                <p className="text-xs text-gray-600">Editor: editor / editor123</p>
              </div>
            )}
          </div>
        </div>
      )}

      {/* News Modal (Add/Edit) */}
      {showNewsModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto">
          <div className="bg-white rounded-2xl shadow-2xl max-w-2xl w-full p-8 relative my-8">
            <button onClick={() => { setShowNewsModal(false); setEditingNews(null); }} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
              <X className="w-6 h-6" />
            </button>

            <h2 className="text-2xl font-bold text-gray-800 mb-6">{editingNews ? 'Edit News' : 'Add New News'}</h2>

            <div className="space-y-4">
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Title</label>
                <input
                  type="text"
                  value={newsForm.title}
                  onChange={(e) => setNewsForm({ ...newsForm, title: e.target.value })}
                  className="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:outline-none transition-all"
                />
              </div>

              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Category</label>
                <select
                  value={newsForm.category}
                  onChange={(e) => setNewsForm({ ...newsForm, category: e.target.value })}
                  className="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:outline-none transition-all"
                >
                  {categories.filter(c => c !== 'All').map(cat => (
                    <option key={cat} value={cat}>{cat}</option>
                  ))}
                </select>
              </div>

              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Image URL</label>
                <input
                  type="url"
                  value={newsForm.image}
                  onChange={(e) => setNewsForm({ ...newsForm, image: e.target.value })}
                  placeholder="https://example.com/image.jpg"
                  className="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:outline-none transition-all"
                />
              </div>

              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">Content</label>
                <textarea
                  value={newsForm.content}
                  onChange={(e) => setNewsForm({ ...newsForm, content: e.target.value })}
                  rows="6"
                  className="w-full px-4 py-3 rounded-lg border-2 border-gray-200 focus:border-blue-500 focus:outline-none transition-all resize-none"
                />
              </div>

              <button
                onClick={editingNews ? handleEditNews : handleAddNews}
                className="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-indigo-700 transition-all shadow-lg"
              >
                {editingNews ? 'Update News' : 'Publish News'}
              </button>
            </div>
          </div>
        </div>
      )}

      {/* View News Modal */}
      {selectedNews && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 overflow-y-auto">
          <div className="bg-white rounded-2xl shadow-2xl max-w-4xl w-full my-8 relative">
            <button onClick={() => setSelectedNews(null)} className="absolute top-4 right-4 bg-white rounded-full p-2 shadow-lg hover:bg-gray-100 z-10">
              <X className="w-6 h-6 text-gray-700" />
            </button>

            <img src={selectedNews.image} alt={selectedNews.title} className="w-full h-96 object-cover rounded-t-2xl" />

            <div className="p-8">
              <div className="flex items-center space-x-3 mb-4">
                <span className="bg-blue-100 text-blue-700 px-4 py-1 rounded-full text-sm font-semibold flex items-center space-x-1">
                  <Tag className="w-4 h-4" />
                  <span>{selectedNews.category}</span>
                </span>
                {selectedNews.trending && (
                  <span className="bg-orange-100 text-orange-700 px-4 py-1 rounded-full text-sm font-semibold flex items-center space-x-1">
                    <TrendingUp className="w-4 h-4" />
                    <span>Trending</span>
                  </span>
                )}
              </div>

              <h1 className="text-4xl font-bold text-gray-800 mb-4">{selectedNews.title}</h1>

              <div className="flex items-center space-x-6 text-sm text-gray-500 mb-6 pb-6 border-b">
                <div className="flex items-center space-x-2">
                  <User className="w-4 h-4" />
                  <span className="font-semibold text-gray-700">{selectedNews.author}</span>
                </div>
                <div className="flex items-center space-x-2">
                  <Clock className="w-4 h-4" />
                  <span>{selectedNews.date}</span>
                </div>
                <div className="flex items-center space-x-2">
                  <Eye className="w-4 h-4" />
                  <span>{selectedNews.views} views</span>
                </div>
              </div>

              <p className="text-gray-700 text-lg leading-relaxed whitespace-pre-line">{selectedNews.content}</p>
            </div>
          </div>
        </div>
      )}

      {/* Footer */}
      <footer className="bg-gradient-to-r from-slate-800 to-slate-900 text-white py-8 mt-12">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
          <p className="text-lg font-semibold mb-2">News Management Portal</p>
          <p className="text-gray-400 text-sm">College Project - Web Development Summer Internship 2025</p>
          <p className="text-gray-500 text-xs mt-4">Â© 2025 All Rights Reserved</p>
        </div>
      </footer>
    </div>
  );
};

export default NewsPortal;

{
        "title" : "Revolutionary AI Breakthrough in Healthcare",
        "category" : "Technology",
        "imageUrl" : "https://www.mindinventory.com/blog/wp-content/uploads/2023/10/ai-in-healthcare-industry.webp",
        "desc" : "Scientists have developed a groundbreaking AI system that can predict diseases with 95% accuracy. This revolutionary technology...",
        "content" : "Scientists have developed a groundbreaking AI system that can predict diseases with 95% accuracy. This revolutionary technology analyzes medical imaging and patient data to identify early signs of various conditions, potentially saving millions of lives through early intervention."
}